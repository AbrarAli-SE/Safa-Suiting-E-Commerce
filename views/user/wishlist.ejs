<%- include('../shared/header') %>

<main class="container mx-auto px-4 py-12 mt-14">
  <!-- Breadcrumb -->
  <div class="text-sm text-gray-700 m-10 mr-3">
    <nav class="flex space-x-2 text-sm text-gray-500">
      <a href="/" class="hover:text-gray-900">Home</a>
      <span>/</span>
      <span class="text-gray-900">Wishlist</span>
    </nav>
  </div>

  <div class="flex items-center justify-between px-4">
    <div class="flex items-center gap-2">
      <div class="w-2 h-6 bg-red-500 rounded"></div>
      <p class="text-red-500 font-semibold px-4">Favourite</p>
    </div>
  </div>

  <div class="flex items-center justify-between flex-col md:flex-row px-4">
    <h2 class="text-3xl font-bold text-center md:text-left">Wishlist</h2>

    <div class="flex md:justify-end justify-center items-center mt-4 space-x-4 mr-4">
      <button class="slider-button left-button bg-[#F5F5F5] p-3 rounded-full transition duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left text-red-600" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
        </svg>
      </button>

      <button class="slider-button right-button bg-[#F5F5F5] p-3 rounded-full transition duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right text-red-600" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Cards Slider Container -->
  <div class="relative border-b border-gray-500 px-4">
    <% if (wishlist.length === 0) { %>
      <p class="text-gray-600 text-center mt-10">Your wishlist is empty. Start adding items!</p>
    <% } else { %>
      <div class="slider-container flex overflow-x-scroll scrollbar-hide space-x-6 p-4 mt-6 mb-8">
        <% wishlist.forEach((item) => { %>
          <div class="bg-[#F5F5F5] h-96 md:w-80 w-72 flex-shrink-0 relative group overflow-hidden rounded-lg shadow-lg">
            <!-- Product Image -->
            <img src="<%= item.product.image %>" alt="<%= item.product.name %>" class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105">

            <!-- Hover Buttons -->
            <div class="absolute top-4 right-4 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <!-- Remove from Wishlist Button (AJAX-enabled) -->
              <button type="button" class="p-2 bg-white rounded-full shadow hover:bg-gray-100 dark:text-black transition duration-300 relative group/button remove-from-wishlist" 
                data-product-id="<%= item.product._id %>">
                <i class="bi bi-trash"></i>
                <span class="absolute left-[-80px] top-1/2 -translate-y-1/2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover/button:opacity-100 transition-opacity duration-300">
                  Remove
                </span>
              </button>

              <!-- Quick View Button -->
              <button class="quick-view-btn p-2 bg-white rounded-full shadow hover:bg-gray-100 dark:text-black transition duration-300 relative group/button"
              data-name="<%= item.product.name %>"
              data-image="<%= item.product.image %>"
              data-price="<%= item.product.price %>"
              data-discountprice="<%= item.product.discountPrice %>"
              data-description="<%= item.product.description || 'No description available.' %>">
                <i class="bi bi-eye"></i>
                <span class="absolute left-[-80px] top-1/2 -translate-y-1/2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover/button:opacity-100 transition-opacity duration-300">
                  Quick View
                </span>
              </button>


              <button class="add-to-cart-btn p-2 bg-white rounded-full shadow hover:bg-gray-100 dark:text-black transition duration-300 relative group/button"
                data-product-id="<%= item.product._id %>">
                <i class="bi bi-cart"></i> <!-- Add to Cart Icon -->
                <span class="absolute left-[-80px] top-1/2 -translate-y-1/2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover/button:opacity-100 transition-opacity duration-300">
                    Add to Cart
                </span>
            </button>
            </div>

            <!-- Product Info -->
            <div class="absolute bottom-0 left-0 right-0 bg-white/90 dark:text-black p-4 translate-y-20 group-hover:translate-y-0 transition-all duration-300">
              <h3 class="font-bold mb-2"><%= item.product.name %></h3>
              <div class="flex justify-between items-center">
                <div>
                  <span class="font-bold">RS. <%=  item.product.price %></span>
                    <span class="text-sm line-through ml-2">Rs. <%= item.product.discountPrice %></span>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>



<div id="quickViewModal"
class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center opacity-0 pointer-events-none transition-all duration-300 z-50">
<div class="bg-white w-96 p-6 rounded-lg relative">
  <button onclick="closeQuickView()"
    class="absolute top-4 right-4 text-xl font-bold dark:text-black text-gray-600">X</button>
  <h3 id="modalProductName" class="font-bold mb-4 dark:text-black"></h3>
  <img id="modalProductImage" src="" alt="Product" class="w-full h-60 object-cover mb-4">
  <div class="flex justify-between mb-4 dark:text-black">
    <span id="modalProductPrice" class="font-bold"></span>
    <span id="modalProductOldPrice" class="text-sm line-through"></span>
  </div>
  <p id="modalProductDesc" class="text-sm text-gray-600 dark:text-black"></p>
</div>
</div>


</main>

<script>
  document.addEventListener("DOMContentLoaded", function () {
   document.querySelectorAll(".quick-view-btn").forEach(button => {
     button.addEventListener("click", function () {
       const modal = document.getElementById("quickViewModal");
       const productName = document.getElementById("modalProductName");
       const productImage = document.getElementById("modalProductImage");
       const productPrice = document.getElementById("modalProductPrice");
       const productOldPrice = document.getElementById("modalProductOldPrice");
       const productDesc = document.getElementById("modalProductDesc");
 
       // Update modal content using data attributes
       productName.innerText = this.getAttribute("data-name");
       productImage.src = this.getAttribute("data-image");
       productPrice.innerText = `Rs : ${this.getAttribute("data-price")}`;
       productOldPrice.innerText = `Rs : ${this.getAttribute("data-discountprice")}`;
       productDesc.innerText = this.getAttribute("data-description");
 
       // Show the modal
       modal.classList.remove("opacity-0", "pointer-events-none");
       modal.classList.add("opacity-100", "pointer-events-auto");
     });
   });
 });
 
 function closeQuickView() {
   const modal = document.getElementById("quickViewModal");
   modal.classList.remove("opacity-100", "pointer-events-auto");
   modal.classList.add("opacity-0", "pointer-events-none");
 }
 
 
  </script>

<script type="module" src="/js/remove.js"></script>
 <!-- <script>
  document.addEventListener("DOMContentLoaded", function () {
  // Handle removing product from wishlist
  const largeScreenWishlistIcon = document.querySelector("#largeScreenWishlist");
  const largeScreenWishlistQuantity = largeScreenWishlistIcon.querySelector("span");
  const smallScreenWishlistIcon = document.querySelector("#smallScreenWishlist");
  const smallScreenWishlistQuantity = smallScreenWishlistIcon.querySelector("span");
  const removeButtons = document.querySelectorAll('.remove-from-wishlist');

  
  // Function to update wishlist quantity
  function updateWishlistQuantity(quantity) {
      largeScreenWishlistQuantity.textContent = quantity;
      smallScreenWishlistQuantity.textContent = quantity;
  }

  // Load wishlist from localStorage
  let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];
  updateWishlistQuantity(wishlist.length);


  removeButtons.forEach(button => {
    button.addEventListener('click', async function () {
      const productId = this.getAttribute('data-product-id');
      const response = await fetch('/user/wishlist/remove', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ productId })
      });

      const result = await response.json();

      if (result.success) {
        // Remove the item from the UI
        this.closest('.group').remove();

        // Remove the product from the localStorage wishlist array
        wishlist = wishlist.filter(id => id !== productId);

        // Save updated wishlist to localStorage
        localStorage.setItem("wishlist", JSON.stringify(wishlist));

        // Update the wishlist quantity in the UI
        updateWishlistQuantity(wishlist.length);
        // Notify the index page to update the heart icon state
        window.postMessage({ type: 'REMOVE_FROM_WISHLIST', productId }, '*');
      } else {
        alert(result.message || "Error removing item.");
      }
    });

     
  });
});

 </script> -->



 <%- include('../shared/footer') %>
