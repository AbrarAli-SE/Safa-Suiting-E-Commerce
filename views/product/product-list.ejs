<%- include('../shared/asideBar') %>

  <main class="flex-grow p-8 ml-0 sm:ml-20 lg:ml-64 overflow-hidden">
    <h1 class="text-4xl font-bold mb-8  sm:mt-7 mt-9">Products List</h1>

    <div class="mb-4 flex justify-between items-center flex-wrap">
     <!-- Search Bar -->
<div class="relative flex items-center w-full sm:w-auto mb-4 sm:mb-0">
  <svg class="absolute left-3 w-5 h-5 text-gray-400 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14z" />
  </svg>
  <input type="text" id="searchInput" placeholder="Search Products..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-400 focus:outline-none w-full sm:w-auto
    dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:placeholder-gray-400">
</div>



      <!-- Add new product -->
      <div class="hidden sm:block">
        <button
          class="px-4 py-2 bg-[#DB4444] text-white rounded-lg hover:bg-[#de2d2d] transition flex items-center space-x-2">
          <i class="bi bi-plus-circle"></i>
          <a href="/admin/product/add-product" class="focus:outline-none">
            Add New Product
          </a>
        </button>
      </div>
    </div>

    <% if (successMessage) { %>
      <div class="bg-green-500 text-white p-3 rounded-lg text-center mb-4">
          <%= successMessage %>
      </div>
    <% } %>
    
    <% if (errorMessage) { %>
      <div class="bg-red-500 text-white p-3 rounded-lg text-center mb-4">
          <%= errorMessage %>
      </div>
    <% } %>
    
  


    <!-- ✅ Product Table -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
      <div class="overflow-x-auto">
        <table class="min-w-full table-auto">
          <thead class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
            <tr>
              <th class="px-4 py-2 text-left w-1/6">Image</th>
              <th class="px-4 py-2 text-left w-1/6">Product Name</th>
              <th class="px-4 py-2 text-left w-1/6">Category</th>
              <th class="px-4 py-2 text-left w-1/6">Brand</th>
              <th class="px-4 py-2 text-left w-1/6">Stock</th>
              <th class="px-4 py-2 text-left w-1/6">Price</th>
              <th class="px-4 py-2 text-left w-1/6">Actions</th>
            </tr>
          </thead>
          <tbody class="text-gray-700 dark:text-gray-300" id="productList">
            <% if (products.length === 0) { %>
              <tr>
                <td colspan="6" class="text-center text-red-500 font-semibold py-4">No products found.</td>
              </tr>
            <% } else { %>
                <% products.forEach((product)=> { %>
                  <tr class="border-t border-gray-200 dark:border-gray-600 product-row">
                    <td class="px-4 py-2">
                      <img src="<%= product.image %>" alt="Product Image" class="w-16 h-16 object-cover rounded">
                    </td>
                    <td class="px-4 py-2 product-name">
                      <%= product.name %>
                    </td>
                    <td class="px-4 py-2 category-name">
                      <%= product.category %>
                    </td>
                    <td class="px-4 py-2 brand-name">
                      <%= product.brand %>
                    </td>
                    <td class="px-4 py-2">
                      <%= product.quantity %>
                    </td>
                    <td class="px-4 py-2">$<%= product.price %>
                    </td>
                    <td class="pr-5 py-2 flex items-center gap-3">
                      <a href="/admin/product/edit/<%= product._id %>" class="px-4 py-2 text-blue-600">
                        Edit
                      </a>
                      <form action="/admin/product/delete-product" method="POST">
                        <input type="hidden" name="productId" value="<%= product._id %>">
                        <input type="hidden" name="page" value="<%= currentPage %>"> <!-- ✅ Pass Current Page -->
                        <button type="submit" class="px-4 py-2 text-red-600">Delete</button>
                    </form>
                    
                    </td>
                  </tr>
                  <% }) %>
                  <% } %>
          </tbody>
        </table>
         <!-- ✅ No Results Message -->
         <p id="noResults" class="text-center text-red-500 font-semibold hidden mt-4">No products found</p>
        </div>
      </div>
    </div>


      <!-- ✅ Pagination -->
  <div class="flex justify-center mt-6">
    <% if (totalPages > 1) { %>
        <nav class="flex items-center space-x-2">
            <% if (currentPage > 1) { %>
                <a href="/admin/product/product-list?page=<%= currentPage - 1 %>" class="px-3 py-1 border rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-white">
                    &laquo; Prev
                </a>
            <% } %>

            <% for (let i = 1; i <= totalPages; i++) { %>
                <a href="/admin/product/product-list?page=<%= i %>" class="px-3 py-1 border rounded-lg <%= currentPage === i ? 'bg-red-500 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-white' %>">
                    <%= i %>
                </a>
            <% } %>

            <% if (currentPage < totalPages) { %>
                <a href="/admin/product/product-list?page=<%= currentPage + 1 %>" class="px-3 py-1 border rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-white">
                    Next &raquo;
                </a>
            <% } %>
        </nav>
    <% } %>
</div>


  </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function(){
      const  productRows = document.querySelectorAll('.product-row');
      const searchInput = document.getElementById('searchInput');
      const noResults = document.getElementById('noResults');

      searchInput.addEventListener('input', function(){
        const query = searchInput.value.toLowerCase();
        let matchFound = false;

        productRows.forEach(row =>{
          const name = row.querySelector('.product-name').textContent.toLowerCase();
          const category = row.querySelector('.category-name').textContent.toLowerCase();
          const brand = row.querySelector('.brand-name').textContent.toLowerCase();

          if(name.includes(query) || category.includes(query) || brand.includes(query)){
            row.style.display = "";
            matchFound = true;
          } else {
            row.style.display = 'none';
          }
        })

         // ✅ Show "No results found" if no matches
         noResults.style.display = matchFound ? "none" : "block";
      })

    });
  </script>
  <!-- Link the JavaScript file -->
  <script src="/js/main.js"></script>
  </body>

  </html>