<%- include('../shared/asideBar') %>

  <main class="flex-grow p-8 ml-0 sm:ml-20 lg:ml-64 overflow-hidden">
    <h1 class="text-4xl font-bold mb-8 sm:mt-7 mt-9">Edit Product</h1>

    <!-- Success & Error Messages -->
    <% if (errorMessage) { %>
      <div class="alert-message bg-red-100 text-red-700 border border-red-400 p-3 rounded mb-4">
        <%= errorMessage %>
      </div>
      <% } %>
        <% if (successMessage) { %>
          <div class="alert-message bg-green-100 text-green-700 border border-green-400 p-3 rounded mb-4">
            <%= successMessage %>
          </div>
          <% } %>

            <!-- Product Upload Form -->
            <form id="product-form" action="/admin/product/update/<%= product._id %>" method="POST"
              enctype="multipart/form-data" class="space-y-6 bg-gray-100 dark:bg-gray-800 p-6 rounded-lg shadow-md">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Side: Product Details Section -->
                <div class="space-y-4">
                  <h2 class="text-2xl font-semibold mb-4">Product Details</h2>

                  <!-- Category & Brand -->
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="space-y-2">
                      <label for="category" class="block text-gray-700 dark:text-gray-300 font-medium">Category</label>
                      <select name="category" id="category"
                        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-400 focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300">
                        <% ['Flash Sales', 'New Arrival' , 'Explore our Products' , 'Best Selling Products'
                          ].forEach(function(cat) { %>
                          <option value="<%= cat %>" <%=product.category===cat ? 'selected' : '' %>><%= cat %>
                          </option>
                          <% }); %>
                      </select>
                    </div>

                    <div class="space-y-2">
                      <label for="brand" class="block text-gray-700 dark:text-gray-300 font-medium">Brand</label>
                      <input type="text" name="brand" id="brand" value="<%= product.brand %>"
                        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-400 focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300"
                        required>
                    </div>
                  </div>

                  <div class="space-y-2">
                    <label for="name" class="block text-gray-700 dark:text-gray-300 font-medium">Product Name</label>
                    <input type="text" name="name" id="name" value="<%= product.name %>"
                      class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-400 focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300"
                      required>
                  </div>

                  <div class="space-y-2">
                    <label for="price" class="block text-gray-700 dark:text-gray-300 font-medium">Price</label>
                    <input type="number" name="price" id="price" value="<%= product.price %>"
                      class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-400 focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300"
                      required>
                  </div>

                  <div class="space-y-2">
                    <label for="description"
                      class="block text-gray-700 dark:text-gray-300 font-medium">Description</label>
                    <textarea name="description" id="description" rows="5"
                      class="w-full p-3 border border-gray-300 resize-none dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-400 focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300"
                      required><%= product.description %></textarea>
                  </div>
                </div>

                <!-- Right Side: Upload & Offers Section -->
                <div class="space-y-4">
                  <h2 class="text-2xl font-semibold mb-4">Additional Details</h2>

                  <!-- Image Upload Section -->
                  <div class="space-y-2">
                    <label for="image" class="block text-gray-700 dark:text-gray-300 font-medium">Upload Product
                      Image</label>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                      <!-- Image Preview Box -->
                      <div
                        class="border-2 border-gray-300 dark:border-gray-600 p-6 rounded-lg text-center flex flex-col items-center justify-center">
                        <div id="image-preview-container"
                          class="w-full h-48 bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400">
                          <% if (product.image) { %>
                            <img id="image-preview" src="<%= product.image %>" class="w-full h-48 rounded-lg">
                            <% } else { %>
                              <p class="text-center">No image available</p>
                              <% } %>
                        </div>
                      </div>

                      <!-- Image Upload Box -->
                      <div
                        class="border-2 border-dashed border-gray-300 dark:border-gray-600 p-6 rounded-lg text-center flex flex-col items-center justify-center">
                        <i class="bi bi-cloud-upload text-gray-500 dark:text-gray-300 text-3xl mb-4"></i>
                        <label for="image" class="cursor-pointer text-blue-500 hover:text-blue-600">Click to
                          browse</label>
                        <input type="file" name="image" id="image" class="hidden" accept="image/*"
                          onchange="previewImage(event)">
                      </div>
                    </div>
                  </div>

                  <!-- Quantity, Discount & Offers -->
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="space-y-2">
                      <label for="quantity" class="block text-gray-700 dark:text-gray-300 font-medium">Quantity</label>
                      <input type="number" name="quantity" id="quantity" value="<%= product.quantity %>"
                        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#DB4444] focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300"
                        required>
                    </div>

                    <div class="space-y-2">
                      <label for="discountPrice" class="block text-gray-700 dark:text-gray-300 font-medium">Discount
                        Price</label>
                      <input type="number" name="discountPrice" id="discountPrice" value="<%= product.discountPrice %>"
                        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#DB4444] focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300">
                    </div>
                  </div>

                  <div class="space-y-2">
                    <label for="keywords" class="block text-gray-700 dark:text-gray-300 font-medium">Keywords</label>
                    <input type of="text" name="keywords" id="keywords" value="<%= product.keywords.join(', ') %>"
                      class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#DB4444] focus:outline-none bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-300"
                      placeholder="shirt, casual, men">
                  </div>

                  <!-- Submit Button -->
                  <button type="submit"
                    class="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">Update
                    Product</button>
                </div>
              </div>
            </form>
  </main>

  <script>
    function previewImage(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const preview = document.getElementById("image-preview");
          preview.src = e.target.result;
          preview.style.display = 'block'; // Make sure to display the image
        };
        reader.readAsDataURL(file);
      }
    }
  </script>

  <script src="/js/main.js"></script>