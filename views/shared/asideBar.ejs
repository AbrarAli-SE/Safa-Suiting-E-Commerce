<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Analytics</title>
  <link rel="shortcut icon" href="/assests/safaLogo.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/styles/global.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">

  <!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

</head>

<body class="transition-all duration-300 bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <header
    class="fixed top-0 left-0 right-0 z-10 flex items-center justify-end dark:bg-gray-800 bg-gray-100 text-white p-2 transition-all shadow-md">
    <!-- Notification Bar -->
    <div class="flex items-center gap-4 mr-4 text-black dark:text-white transition-all">
      <!-- Bell Icon -->
      <button class="relative" id="notification" onclick="openNotifications()">
        <i class="bi bi-bell text-2xl"></i>
        <span id="notificationCount"
            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1 hidden">
        </span>
      </button>

      <!-- Notification Dropdown -->
      <div id="notificationDropdown"
        class="hidden absolute right-7 mt-56 min-w-56 bg-white border border-gray-300 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-600 max-h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100 dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-700">
        <ul id="notificationList" class="list-none p-2">
            <li class="py-2 px-4 text-gray-500">No new notifications</li>
        </ul>
      </div>

    




      <!-- Hamburger Menu -->
      <button id="hamburgerMenu" class="sm:hidden block p-2 rounded-md text-black dark:text-white transition-all">
        <i class="bi bi-list text-2xl"></i>
      </button>
    </div>
  </header>


  <div class="flex">
    <!-- Sidebar -->
    <aside id="sidebar"
      class="h-screen z-20 p-4 bg-gray-100 dark:bg-gray-800 fixed top-0 left-0 flex flex-col transition-all duration-300 transform -translate-x-full sm:translate-x-0 sm:w-20 lg:w-64 border-r-2 border-gray-200 dark:border-gray-700">
      <h2 class="sidebar-heading text-gray-900 dark:text-gray-100">Admin Panel</h2>
      <hr class="sidebar-divider border-gray-400 dark:border-gray-600">

      <nav class="leading-2 tracking-tighter space-y-4">
        <!-- Manage Products with Dropdown -->
        <div class="relative text-gray-900 dark:text-gray-100">
          <!-- Main Button -->
          <button
            class="sidebar-link text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none w-full"
            id="manageProductsButton">
            <span class="flex items-center">
              <i class="bi bi-box"></i>
              <span class="hidden lg:inline ml-4">Manage Products</span>
            </span>
            <i class="bi bi-chevron-down"></i>
          </button>


          <!-- Dropdown Menu -->
          <ul id="manageProductsDropdown"
            class="hidden flex-col items-start  z-10 transition-all duration-500 ease-in-out opacity-0 translate-y-5 mt-2">
            <li class="w-full group relative py-1">
              <a href="/admin/product/add-product"
                class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
                <i class="bi bi-plus-circle"></i>
                <span class="hidden lg:inline">Add Products</span>
                <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Add Prodcuts</span>
              </a>
            </li>
            <li class="w-full group relative py-1">
              <a href="/admin/product/product-list"
                class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
                <i class="bi bi-list-ul"></i>
                <span class="hidden lg:inline">Products List</span>
                <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Products List</span>
              </a>
            </li>
            <li class="w-full group relative py-1">
              <a href="/admin/manage-carousel"
                class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
                <i class="bi bi-sliders"></i>
                <span class="hidden lg:inline">Update Coursel</span>
                <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Update Coursel</span>
              </a>
            </li>

          </ul>
        </div>
        <a href="/admin/coupon-code"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-tag"></i>
          <span class="hidden lg:inline">Apply Coupon Codes</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Apply Coupon Codes</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/admin/assign-id"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-truck"></i>
          <span class="hidden lg:inline">Track Orders</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Track Orders</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/admin/payment"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-credit-card"></i>
          <span class="hidden lg:inline">View Payments</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">View Payments</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/admin/cancel-order"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-x-circle"></i>
          <span class="hidden lg:inline">Cancel Orders</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Cancel Orders</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/admin/users"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-people"></i>
          <span class="hidden lg:inline">Manage Users</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Manage Users</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/admin/analytical"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-bar-chart"></i>
          <span class="hidden lg:inline">Analytics</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Analytics</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/admin/contacts"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-person-rolodex"></i>
          <span class="hidden lg:inline">Contacts</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Contacts</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/admin/setting"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-gear"></i>
          <span class="hidden lg:inline">Settings</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Settings</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <a href="/auth/logout"
          class="sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none">
          <i class="bi bi-box-arrow-right"></i>
          <span class="hidden lg:inline">Logout</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden">Logout</span>
          <!-- Visible on sm and md, hidden on lg -->
        </a>
        <buton
          class="cursor-pointer sidebar-link group text-gray-900 dark:text-gray-100 focus:outline-none sm:focus:outline-none md:focus:outline-none -ml-1 "
          id="darkModeToggle">
          <i class="bi bi-moon text-xl dark:hidden"></i>
          <i class="bi bi-sun text-xl hidden dark:inline"></i>
          <span class="hidden lg:inline">Dark Mode</span>
          <span class="sidebar-tooltip hidden sm:inline md:inline lg:hidden focus:outline-none">Toggle Dark
            Mode</span>
          <!-- Visible on sm and md, hidden on lg -->
        </buton>
      </nav>
    </aside>


    <!-- <script>
      document.addEventListener("DOMContentLoaded", function () {
          fetchNotifications();
      });
  
      // ✅ Fetch Notifications
      async function fetchNotifications() {
          try {
              const res = await fetch("/admin/notifications");
              const data = await res.json();
  
              if (data.success) {
                  const totalCount = data.totalNotifications;
                  const notificationCount = document.getElementById("notificationCount");
  
                  if (totalCount > 0) {
                      notificationCount.textContent = totalCount;
                      notificationCount.classList.remove("hidden");
                  } else {
                      notificationCount.classList.add("hidden");
                  }
  
                  const notificationList = document.getElementById("notificationList");
                  notificationList.innerHTML = "";
  
                  if (data.newUsers > 0) {
                      notificationList.innerHTML += `
                          <li class="py-2 px-4 text-gray-700 hover:bg-gray-100 cursor-pointer dark:text-gray-300 dark:hover:bg-gray-700">
                              <p>${data.newUsers} new user(s) registered.</p>
                              <span class="text-xs text-gray-500 dark:text-gray-400 block mt-1">Just now</span>
                          </li>`;
                  }
  
                  if (data.newContacts > 0) {
                      notificationList.innerHTML += `
                          <li class="py-2 px-4 text-gray-700 hover:bg-gray-100 cursor-pointer dark:text-gray-300 dark:hover:bg-gray-700">
                              <p>${data.newContacts} new contact message(s) received.</p>
                              <span class="text-xs text-gray-500 dark:text-gray-400 block mt-1">Just now</span>
                          </li>`;
                  }
  
                  if (data.newUsers === 0 && data.newContacts === 0) {
                      notificationList.innerHTML = `<li class="py-2 px-4 text-gray-500">No new notifications</li>`;
                  }
              }
          } catch (error) {
              console.error("❌ Error fetching notifications:", error);
          }
      }
  
      // ✅ Mark Notifications as Read when Bell is Clicked
      function openNotifications() {
          fetch("/admin/notifications/mark-read", { method: "POST" })
              .then(() => {
                  document.getElementById("notificationCount").classList.add("hidden");
                  fetchNotifications();
              })
              .catch(error => console.error("❌ Error marking notifications as read:", error));
  
          const dropdown = document.getElementById("notificationDropdown");
          dropdown.classList.toggle("hidden");
      }
  
      // ✅ Refresh notifications every 10 seconds
      setInterval(fetchNotifications, 10000);
  </script> -->
  
      