<%- include('../shared/header') %>

<main class="container mx-auto px-4 py-12 mt-14">
  <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 pt-16">
    <!-- Cart Items Section (Left Side) -->
    <div class="md:col-span-2 space-y-6">
      <% if (cart.length === 0) { %>
        <p class="text-[var(--color-gray-600)] text-lg text-center">Your cart is empty.</p>
      <% } else { %>
        <h2 class="text-3xl font-bold text-[var(--color-black)] mb-6">Shopping Cart</h2>
        <!-- Scrollable Container -->
        <div class="cart-items-container overflow-y-auto max-h-96 space-y-4">
          <% cart.forEach(item => { %>
            <div class="bg-[var(--color-white)] shadow-lg rounded-lg p-4 flex flex-col sm:flex-row items-center justify-between border-[var(--color-gray-300)] cart-item" data-item-id="<%= item._id %>">
              <div class="flex items-center gap-4 w-full sm:w-auto">
                <button 
                  class="text-[var(--color-red-500)] hover:text-[var(--color-red-700)] p-1 rounded-full bg-[var(--color-red-50)] remove-item transition-all duration-300" 
                  data-item-id="<%= item._id %>">
                  <i class="bi bi-x text-xl"></i>
                </button>
                <img src="<%= item.product.image %>" alt="<%= item.product.name %>" class="w-24 h-20 object-cover rounded">
                <div>
                  <h3 class="font-semibold text-[var(--color-black)]"><%= item.product.name %></h3>
                  <span class="text-[var(--color-gray-600)] text-sm">Price: <span class="price" data-price="<%= item.price %>">Rs <%= item.price %></span></span>
                </div>
              </div>
              <div class="flex items-center gap-4 mt-4 sm:mt-0">
                <input 
                  type="number" 
                  value="<%= item.quantity || 1 %>" 
                  min="1" 
                  class="quantity w-16 px-3 py-2 text-center border border-[var(--color-gray-300)] rounded-md bg-[var(--color-gray-50)] focus:outline-none focus:ring-2 focus:ring-[var(--color-red-500)] transition-all duration-300" 
                  data-item-id="<%= item._id %>">
                <span class="font-semibold text-[var(--color-black)] subtotal">Rs <%= (item.price * (item.quantity || 1)) %></span>
              </div>
            </div>
          <% }) %>
        </div>

        <!-- Buttons -->
        <div class="flex justify-between pt-6 cart-buttons">
          <a 
            href="/" 
            class="px-6 py-2.5 border border-[var(--color-gray-300)] text-[var(--color-black)] rounded-lg hover:bg-[var(--color-gray-100)] transition-all duration-300">
            Return To Shop
          </a>
          <button 
            id="updateCart" 
            class="px-6 py-2.5 border border-[var(--color-gray-300)] text-[var(--color-black)] rounded-lg hover:bg-[var(--color-gray-100)] transition-all duration-300">
            Update Cart
          </button>
        </div>
      <% } %>
    </div>

    <!-- Cart Total Section (Right Side) -->
    <% if (cart.length > 0) { %>
      <div class="cart-total-section border border-[var(--color-gray-300)] rounded-lg p-6 bg-[var(--color-white)] shadow-lg w-full md:w-[400px] self-start flex flex-col">
        <h2 class="text-xl font-semibold text-[var(--color-black)] mb-6">Cart Total</h2>
        <div class="space-y-4 flex-grow">
          <div class="flex justify-between items-center py-3 border-t border-[var(--color-gray-200)]">
            <span class="text-[var(--color-gray-600)]">Subtotal:</span>
            <span id="cartSubtotal" class="font-medium text-[var(--color-black)]">Rs <%= totalAmount || cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0) %></span>
          </div>
          <div class="flex justify-between items-center py-3 border-t border-[var(--color-gray-200)]">
            <span class="text-[var(--color-gray-600)]">Shipping:</span>
            <span class="font-medium text-[var(--color-black)]">Free</span>
          </div>
          <div class="flex justify-between items-center py-3 border-t border-[var(--color-gray-200)]">
            <span class="text-[var(--color-gray-600)]">Total:</span>
            <span id="cartTotal" class="font-medium text-[var(--color-black)]">Rs <%= totalAmount || cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0) %></span>
          </div>
        </div>
        <a 
          href="/user/cart/checkout" 
          class="w-full px-6 py-3 mt-6 bg-[var(--color-red-500)] text-[var(--color-white)] font-semibold rounded-lg hover:bg-[var(--color-red-700)] transition-all duration-300 shadow-md hover:shadow-lg text-center">
          Proceed to Checkout
        </a>
      </div>
    <% } %>
  </div>
</main>

<script type="module" src="/js/updateCart.js"></script>

<%- include('../shared/footer') %>