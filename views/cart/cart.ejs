<%- include('../shared/header') %>
<!-- views/cart.ejs -->
<main class="container mx-auto px-4 py-12 mt-14">
  <div class="max-w-7xl mx-auto">
    <!-- Cart Title Section -->
    <div class="flex items-center justify-between px-4 sm:px-6 lg:px-8 mb-6">
      <div class="flex items-center gap-2">
        <div class="w-2 h-6 bg-[var(--color-red-500)] rounded"></div>
        <p class="text-[var(--color-red-500)] font-semibold">Your Cart</p>
      </div>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 px-4 sm:px-6 lg:px-8">
      <!-- Cart Items Section (Left Side) -->
      <div class="md:col-span-2 space-y-6">
        <% if (cart.length === 0) { %>
          <p class="text-[var(--color-gray-600)] text-lg text-center mt-10">Your cart is empty. Start adding items!</p>
        <% } else { %>
          <h2 class="text-3xl font-bold text-[var(--color-black)] text-center md:text-left mb-6">Shopping Cart</h2>
          <!-- Scrollable Container -->
          <div class="cart-items-container space-y-4 max-h-[28rem] overflow-y-auto scrollbar-hide">
            <% cart.forEach(item => { %>
              <div class="bg-[var(--color-white)] shadow-lg rounded-lg p-4 flex flex-col sm:flex-row items-start justify-between border-[var(--color-gray-300)] cart-item transition-all duration-300 hover:shadow-xl" data-item-id="<%= item._id %>">
                <div class="flex flex-col sm:flex-row items-start gap-4 w-full">
                  <div class="flex items-center gap-4 w-full sm:w-auto">
                    <button class="remove-item p-2 bg-[var(--color-red-50)] text-[var(--color-red-500)] rounded-full hover:bg-[var(--color-red-500)] hover:text-[var(--color-white)] transition-all duration-300" data-item-id="<%= item._id %>">
                      <i class="bi bi-trash text-lg"></i>
                    </button>
                    <img src="<%= item.product.image %>" alt="<%= item.product.name %>" class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded flex-shrink-0">
                  </div>
                  <div class="flex-1 text-center sm:text-left mt-2 sm:mt-0">
                    <h3 class="font-semibold text-[var(--color-black)] text-base sm:text-lg"><%= item.product.name %></h3>
                    <span class="text-[var(--color-gray-600)] text-sm">Price: <span class="price" data-price="<%= item.price %>">Rs <%= item.price %></span></span>
                  </div>
                </div>
                <div class="flex flex-col sm:flex-row items-center gap-4 mt-4 sm:mt-0 w-full sm:w-auto justify-center sm:justify-end">
                  <div class="flex items-center border border-[var(--color-gray-300)] rounded-md overflow-hidden w-28 sm:w-32">
                    <button class="quantity-decrease w-8 h-8 flex items-center justify-center text-[var(--color-gray-600)] hover:text-[var(--color-red-500)] hover:bg-[var(--color-gray-100)] transition-all duration-300" data-item-id="<%= item._id %>">-</button>
                    <span class="quantity-value w-12 px-2 py-2 text-center bg-[var(--color-gray-50)] text-[var(--color-black)] text-sm" data-item-id="<%= item._id %>"><%= item.quantity || 1 %></span>
                    <button class="quantity-increase w-8 h-8 flex items-center justify-center text-[var(--color-gray-600)] hover:text-[var(--color-red-500)] hover:bg-[var(--color-gray-100)] transition-all duration-300" data-item-id="<%= item._id %>">+</button>
                  </div>
                  <span class="font-semibold text-[var(--color-black)] subtotal text-sm sm:text-base min-w-[80px] text-right">Rs <%= (item.price * (item.quantity || 1)).toFixed(2) %></span>
                </div>
              </div>
            <% }); %>
          </div>

          <!-- Buttons -->
          <div class="flex flex-col sm:flex-row justify-between gap-4 pt-6 cart-buttons">
            <a href="/" class="p-root-3 border border-[var(--color-gray-300)] text-[var(--color-black)] rounded-lg hover:bg-[var(--color-gray-100)] transition-all duration-300 text-center">Return To Shop</a>
            <button id="updateCart" class="p-root-3 border border-[var(--color-gray-300)] text-[var(--color-black)] rounded-lg hover:bg-[var(--color-gray-100)] transition-all duration-300">Update Cart</button>
          </div>
        <% } %>
      </div>

      <!-- Cart Total Section (Right Side) -->
      <% if (cart.length > 0) { %>
        <div class="cart-total-section border border-[var(--color-gray-300)] rounded-lg p-6 bg-[var(--color-white)] shadow-lg w-full self-start flex flex-col">
          <h2 class="text-xl font-semibold text-[var(--color-black)] mb-6 text-center md:text-left">Cart Total</h2>
          <div class="space-y-4 flex-grow">
            <div class="flex justify-between items-center py-3 border-t border-[var(--color-gray-200)]">
              <span class="text-[var(--color-gray-600)] text-sm sm:text-base">Subtotal:</span>
              <span id="cartSubtotal" class="font-medium text-[var(--color-black)] text-sm sm:text-base">Rs <%= totalAmount || cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0).toFixed(2) %></span>
            </div>
            <div class="flex justify-between items-center py-3 border-t border-[var(--color-gray-200)]">
              <span class="text-[var(--color-gray-600)] text-sm sm:text-base">Shipping:</span>
              <span class="font-medium text-[var(--color-black)] text-sm sm:text-base">Free</span>
            </div>
            <div class="flex justify-between items-center py-3 border-t border-[var(--color-gray-200)]">
              <span class="text-[var(--color-gray-600)] text-sm sm:text-base">Total:</span>
              <span id="cartTotal" class="font-medium text-[var(--color-black)] text-sm sm:text-base">Rs <%= totalAmount || cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0).toFixed(2) %></span>
            </div>
          </div>
          <a href="/user/cart/checkout" class="w-full p-root-3 mt-6 bg-[var(--color-red-500)] text-[var(--color-white)] font-semibold rounded-lg hover:bg-[var(--color-red-700)] transition-all duration-300 shadow-md hover:shadow-lg text-center text-sm sm:text-base">Proceed to Checkout</a>
        </div>
      <% } %>
    </div>
  </div>
</main>


<%- include('../shared/footer') %>
<script type="module" src="/js/updateCart.js"></script>
